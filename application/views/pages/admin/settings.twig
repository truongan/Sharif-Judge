{#
 # Sharif Judge
 # file: settings.twig
 # author: Mohammad Javad Naderi <mjnaderi@gmail.com>
 #}
{% set selected = 'settings' %}
{% extends 'templates/base.twig' %}
{% block icon %}fas fa-sliders-h{% endblock %}
{% block title %}Settings{% endblock %}
{% block head_title %}Settings{% endblock %}



{% block body_end %}
<script type='text/javascript' src="{{ base_url('assets/js/taboverride.min.js') }}"></script>
<script>
$(document).ready(function(){
	tabOverride.set(document.getElementsByTagName('textarea'));
});
</script>
{% endblock %}



{% block title_menu %}
<span class="title_menu_item ml-auto">
	<a href="https://github.com/truongan/wecode-judge/blob/docs/v1.4/settings.md" target="_blank"><i class="fa fa-question-circle color6"></i> Help</a>
</span>
{% endblock %}



{% block main_content %}

{% if form_status == 'ok' %}
	<div class="alert alert-success">Settings updated successfully.</div>
{% elseif form_status == 'error' %}
	<div class="alert alert-danger">Error updating settings.</div>
{% endif %}
{% for error in errors %}
	<div class="alert alert-danger">{{ error }}</div>
{% endfor %}
{# {% if not defc %}
	<div class="alert alert-danger">"Tester path" is not correct.</div>
{% endif %} #}
<div class="col-12">
	{{ form_open('settings/update') }}
		<h5>Display settings</h5><hr>
		<div class="form-row">
			<fieldset class="form-group col-md-4">
				<label for="form_site_name">Site name</label>
				<input id="form_site_name" type="text" name="site_name" class="form-control" value="{{ site_name }}"/>
				<small class="form-text text-muted">Website's name to be display on Top Bar and HTML title.</small>
			</fieldset>

			<fieldset class="form-group col-md-4">
				<label for="form_timezone">Timezone </label>
				<input id="form_timezone" type="text" name="timezone" class="form-control" value="{{ timezone }}"/>
				{{ form_error('timezone', '<div class="alert alert-danger">', '</div>') }}
				<small class="form-text ">
					<a target="_blank" href="http://www.php.net/manual/en/timezones.php">list of timezones</a>
					<span class="form-text text-muted timer"></span>
				</small>
			</fieldset>

			<fieldset class="form-group col-md-2">
				<label for="form_week">Week Start Day</label>
				<select id="form_week" name="week_start" class="form-control custom-select">
					<option value="0" {{ week_start == 0 ? 'selected="selected"' }}>Sunday</option>
					<option value="1" {{ week_start == 1 ? 'selected="selected"' }}>Monday</option>
					<option value="2" {{ week_start == 2 ? 'selected="selected"' }}>Tuesday</option>
					<option value="3" {{ week_start == 3 ? 'selected="selected"' }}>Wednesday</option>
					<option value="4" {{ week_start == 4 ? 'selected="selected"' }}>Thursday</option>
					<option value="5" {{ week_start == 5 ? 'selected="selected"' }}>Friday</option>
					<option value="6" {{ week_start == 6 ? 'selected="selected"' }}>Saturday</option>
				</select>
			</fieldset>

			<fieldset class="form-group col-md-2">
				<label for="theme">Theme</label>
				<select id="theme" name="theme" class="form-control custom-select">
					<optgroup label="Light">
						<option value="lumen" {{ user.theme == "lumen" ? 'selected="selected"' : '' }} >lumen</option>
						<option value="litera" {{ user.theme == "litera" ? 'selected="selected"' : '' }} >litera</option>
						{# <option value="material-design" {{ user.theme == "material-design" ? 'selected="selected"' : '' }} >material-design</option> #}
						<option value="pulse" {{ user.theme == "pulse" ? 'selected="selected"' : '' }} >pulse</option>
						<option value="cosmo" {{ user.theme == "cosmo" ? 'selected="selected"' : '' }} >cosmo</option>
						<option value="journal" {{ user.theme == "journal" ? 'selected="selected"' : '' }} >journal</option>
						<option value="flatly" {{ user.theme == "flatly" ? 'selected="selected"' : '' }} >flatly</option>
						<option value="sketchy" {{ user.theme == "sketchy" ? 'selected="selected"' : '' }} >sketchy</option>
						<option value="cerulean" {{ user.theme == "cerulean" ? 'selected="selected"' : '' }} >cerulean</option>
						<option value="united" {{ user.theme == "united" ? 'selected="selected"' : '' }} >united</option>
						<option value="yeti" {{ user.theme == "yeti" ? 'selected="selected"' : '' }} >yeti</option>
						<option value="sandstone" {{ user.theme == "sandstone" ? 'selected="selected"' : '' }} >sandstone</option>
						<option value="simplex" {{ user.theme == "simplex" ? 'selected="selected"' : '' }} >simplex</option>
					</optgroup>
					<optgroup label="Dark">
						<option value="cyborg" {{ user.theme == "cyborg" ? 'selected="selected"' : '' }} >cyborg</option>
						<option value="darkly" {{ user.theme == "darkly" ? 'selected="selected"' : '' }} >darkly</option>
						<option value="slate" {{ user.theme == "slate" ? 'selected="selected"' : '' }} >slate</option>
						<option value="superhero" {{ user.theme == "superhero" ? 'selected="selected"' : '' }} >superhero</option>
						<option value="solar" {{ user.theme == "solar" ? 'selected="selected"' : '' }} >solar</option>
					</optgroup>
					<optgroup label="Spacy">
						<option value="lux" {{ user.theme == "lux" ? 'selected="selected"' : '' }} >lux</option>
						<option value="materia" {{ user.theme == "materia" ? 'selected="selected"' : '' }} >materia</option>
						<option value="spacelab" {{ user.theme == "spacelab" ? 'selected="selected"' : '' }} >spacelab</option>

						<!-- <option value="minty" {{ user.theme == "minty" ? 'selected="selected"' : '' }} >minty</option> -->
					</optgroup>

					<option value="default" {{ user.theme == "default" ? 'selected="selected"' : '' }} >default</option>
				</select>
				<small class="form-text text-muted">This settings only take effect for other user after they (re)login</small>
			</fieldset>
		</div>

		<br><h5>System settings</h5><hr>
		<div class="form-row">
			<fieldset class="form-group col-md">
				<label for="form_t_path">Full Path to <code>tester</code></label>
				<input id="form_t_path" type="text" name="tester_path" class="form-control medium" value="{{ tester_path }}"/>
			</fieldset>
			<fieldset class="form-group col-md">
				<label for="form_a_path">Full Path to <code>assignments</code></label>
				<input id="form_a_path" type="text" name="assignments_root" class="form-control medium" value="{{ assignments_root }}"/>
			</fieldset>
			{# <fieldset class="form-group col-md-2">
				<div class="custom-control custom-switch">
					<input id="form_log" type="checkbox" class="custom-control-input" name="enable_log" value="1" {{ enable_log ? 'checked' }}/>
					<label for="form_log" class="custom-control-label">Log</label>
				</div>
				<small class="form-text text-muted">Enable tester Log. This options is highly recommended</small>
			</fieldset> #}
		</div>
		<div class="form-row">
			<fieldset class="form-group col-md-4">
				<label for="form_concurent_queue_process">Number of queue process</label>
				<input id="form_concurent_queue_process" type="number" name="concurent_queue_process" class="form-control" value="{{ concurent_queue_process }}" />
				<small class="form-text text-muted">The number of queue process to run at the same time. This settings is sensitive to the server hardware capabilities. Set this to 0 will disable queue and stop judging all submissions</small>
			</fieldset> 
			<fieldset class="form-group col-md-4">
				<label for="default_language_number">Number of default language</label>
				<input id="default_language_number" type="number" name="default_language_number" class="form-control" value="{{ default_language_number }}" />
				<small class="form-text text-muted">The number language to be enabled by default for newly added problem</small>
			</fieldset>
		</div>

		<br><h5>Judge settings</h5><hr>
		<div class="form-row">
			<fieldset class="form-group col-md-3">
				<label for="form_up_limit">Upload Size Limit (kB)</label>
				<input id="form_up_limit" type="number" name="file_size_limit" class="form-control medium" value="{{ file_size_limit }}"/>
				{{ form_error('file_size_limit', '<div class="alert alert-danger">', '</div>') }}
			</fieldset>
			<fieldset class="form-group col-md-3">
				<label for="form_out_limit">Output Size Limit (kB)</label>
				<input id="form_out_limit" type="number" name="output_size_limit" class="form-control medium" value="{{ output_size_limit }}"/>
				<small class="form-text text-muted">Sets a limit for size of output file generated by submitted code</small>
				{{ form_error('output_size_limit', '<div class="alert alert-danger">', '</div>') }}
			</fieldset>
			<fieldset class="form-group col-md-3">
				<label for="form_rpp_all">Results Per Page</label>
				<input id="form_rpp_all" type="number" name="rpp_all" class="form-control medium" value="{{ results_per_page_all }}"/>
				<small class="form-text text-muted">In "All Submissions"<br>Enter 0 for no limit</small>
				{{ form_error('results_per_page_all', '<div class="alert alert-danger">', '</div>') }}
			</fieldset>
			<fieldset class="form-group col-md-3">
				<label for="form_rpp_final">Results Per Page</label>
				<input id="form_rpp_final" type="number" name="rpp_final" class="form-control medium" value="{{ results_per_page_final }}"/>
				<small class="form-text text-muted">In "Final Submissions"<br>Enter 0 for no limit</small>
				{{ form_error('results_per_page_final', '<div class="alert alert-danger">', '</div>') }}
			</fieldset>
		</div>

		<div class="form-row">
			<fieldset class="form-group col-md-2">
				<label for="form_en_reg">Registration</label>
				<input id="form_en_reg" type="checkbox" name="enable_registration" value="1" {{ enable_registration ? 'checked' }}/>
				<small class="form-text text-muted">Open Public Registration.</small>
			</fieldset>
			<fieldset class="form-group col-md-4">
					<label for="form_reg_code">Registration Code</label>
					<input id="form_reg_code" type="text" name="registration_code" class="form-control medium" value="{{ registration_code }}"/>
					<small class="form-text text-muted">If you want to enable registration (above option), It is better to give a registration code	to students in your class for validating registration. Enter 0 to disable.</small>
					{{ form_error('registration_code', '<div class="alert alert-danger">', '</div>') }}
			</fieldset>
			<fieldset class="form-group col-md-6">
				<div class="row">
					<div class="col-sm-3">
						<label for="form_late_rule">Default Coefficient Rule</label>
						<small class="form-text text-muted">PHP script without &lt;?php ?&gt; tags</small>
					</div>
						<div class="col-sm-9">
						<textarea id="form_late_rule" name="default_late_rule" rows="15" class="form-control add_text clear">{{ default_late_rule }}</textarea>
					</div>
				</div>
			</fieldset>
		</div>


		<br><h4>Emails settings</h4><hr>
		<div class="form-row">
			<fieldset class="form-group col-md-6">
				<label for="form_mail_from">Send Emails From</label>
				<input id="form_mail_from" type="text" name="mail_from" class="form-control medium" value="{{ mail_from }}"/>
				{{ form_error('mail_from', '<div class="alert alert-danger">', '</div>') }}
			</fieldset>
			<fieldset class="form-group col-md-6">
				<label for="form_mail_name">Send Emails "From" Name</label>
				<input id="form_mail_name" type="text" name="mail_from_name" class="form-control medium" value="{{ mail_from_name }}"/>
				{{ form_error('mail_from_name','<div class="alert alert-danger">','</div>') }}
			</fieldset>
		</div>
		<div class="form-row">
			<fieldset class="form-group col-md-6">
				<div class="row">
					<div class="col-sm-3">
						<label for="form_mail_reset">Password Reset Email</label>
						<small class="form-text text-muted">You can use {SITE_URL}, {RESET_LINK} and {VALID_TIME}</small>
					</div>
					<div class="col-sm-9">
						<textarea id="form_mail_reset" name="reset_password_mail" rows="15" class="form-control add_text clear">{{ reset_password_mail }}</textarea>
					</div>
				</div>
			</fieldset>
			<fieldset class="form-group col-md-6">
				<div class="row">
					<div class="col-sm-3">
						<label for="form_mail_add">Add User Email</label>
						<small class="form-text text-muted">You can use {SITE_URL}, {LOGIN_URL}, {ROLE}, {USERNAME} and {PASSWORD}</small>
					</div>
					<div class="col-sm-9">
						<textarea id="form_mail_add" name="add_user_mail" rows="15" class="form-control add_text clear">{{ add_user_mail }}</textarea>
					</div>
				</div>
			</fieldset>
		</div>



	{# Since we employed docker container already. Primitive sand boxing can be retired #}
	{#
		<h2 class="shj_form">
			Sandboxing <span class="title_menu_item">
				<a href="https://github.com/truongan/wecode-judge/blob/docs/v1.4/sandboxing.md" target="_blank"><i class="fa fa-question-circle color11"></i> Help</a>
			</span>
		</h2>
	 	<p class="input_p">
			<input id="form_easysandbox" type="checkbox" name="enable_easysandbox" value="1" {{ enable_easysandbox ? 'checked' }}/>
			<label for="form_easysandbox">EasySandbox</label>
		</p>
		<p class="form_comment">Enable EasySandbox for C/C++.<br>
			You must <a href="https://github.com/truongan/wecode-judge/blob/docs/v1.4/sandboxing.md#build-easysandbox" target="_blank">build EasySandbox</a> before enabling it.<br>
			{% if not sandbox_built %}
				<span style="color: red;">You have not built EasySandbox yet.</span>
			{% endif %}
		</p>

		<p class="input_p">
			<input id="form_java_policy" type="checkbox" name="enable_java_policy" value="1" {{ enable_java_policy ? 'checked' }}/>
			<label for="form_java_policy">Java Policy</label>
		</p>
		<p class="form_comment">
			Enable <a href="https://github.com/truongan/wecode-judge/blob/docs/v1.4/sandboxing.md#java-sandboxing" target="_blank">Java Sandboxing</a>
		</p>
	#}

{# 
		<br><h4 >
			Shield settings <span class="title_menu_item">
				<a href="https://github.com/truongan/wecode-judge/blob/docs/v1.4/shield.md" target="_blank"><i class="fa fa-question-circle color11"></i> Help</a>
			</span>
		</h4><hr>
		<div class="form-row">
			<fieldset class="form-group col-md-6">
				<label for="form_c_sh"  class="sr-only">C Shield</label>
				<label for="form_def_c">Shield Rules (for C)</label>
				<small class="form-text text-muted">Enable <a href="https://github.com/truongan/wecode-judge/blob/docs/v1.4/shield.md" target="_blank">Shield</a> for C</small>
				<div class="input-group">
					<span class="input-group-addon">
						<input id="form_c_sh" type="checkbox" name="enable_c_shield" value="1" {{ enable_c_shield ? 'checked' }}/>
					</span>
					<textarea id="form_def_c" name="def_c" rows="15" class="form-control add_text clear">{{ defc }}</textarea>
				</div>
			</fieldset>
			<fieldset class="form-group col-md-6">
				<label for="form_def_cpp">Shield Rules (for C++)</label>
				<label for="form_cpp_sh" class="sr-only" >C++ Shield</label><br>
				<small class="form-text text-muted">Enable <a href="https://github.com/truongan/wecode-judge/blob/docs/v1.4/shield.md" target="_blank">Shield</a> for C++</small>
				<div class="input-group">
					<span class="input-group-addon">
						<input id="form_cpp_sh" type="checkbox" name="enable_cpp_shield" value="1" {{ enable_cpp_shield ? 'checked' }}/>
					</span>
					<textarea id="form_def_cpp" name="def_cpp" rows="15" class="form-control add_text clear">{{ defcpp }}</textarea>
				</div>
			</fieldset>
			<fieldset class="form-group col-md-6">
				<label for="form_shield_py2">Shield (for Python 2)</label>
				<label for="form_py2_sh" class="sr-only">Python 2 Shield</label><br>
				<small class="form-text text-muted">Enable <a href="https://github.com/truongan/wecode-judge/blob/docs/v1.4/shield.md" target="_blank">Shield</a> for Python 2</small>
				<div class="input-group">
					<span class="input-group-addon">
					<input id="form_py2_sh" type="checkbox" name="enable_py2_shield" value="1" {{ enable_py2_shield ? 'checked' }}/>
					</span>
					<textarea id="form_shield_py2" name="shield_py2" rows="15" class="form-control add_text clear">{{ shield_py2 }}</textarea>
				</div>
			</fieldset>
			<fieldset class="form-group col-md-6">
				<label for="form_shield_py3">Shield (for Python 3)</label>
				<label for="form_py3_sh">Python 3 Shield</label><br>
				<small class="form-text text-muted">Enable <a href="https://github.com/truongan/wecode-judge/blob/docs/v1.4/shield.md" target="_blank">Shield</a> for Python 3</small>
				<div class="input-group">
					<span class="input-group-addon">
						<input id="form_py3_sh" type="checkbox" name="enable_py3_shield" value="1" {{ enable_py3_shield ? 'checked' }}/>
					</span>
					<textarea id="form_shield_py3" name="shield_py3" rows="15" class="form-control add_text clear">{{ shield_py3 }}</textarea>
				</div>
			</fieldset>
		</div> #}

		<div class="row mb-2">
			<div class="offset-sm-8 col-sm-4">
				<input type="submit" value="Save Changes" class="form-control btn btn-primary"/>
			</div>
		</div>
	</form>
</div>

{% endblock %}  {# main_content #}
