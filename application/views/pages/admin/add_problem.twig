{#
 # Wecode Judge
 # file: add_problem.twig
 # author:truongan (hostmaster@truongan.name.vn)
 #}
{% set selected = 'Problems' %}
{% extends 'templates/base.twig' %}
{% block icon %}{{ edit ? 'fa-edit' : 'fa-plus-square' }}{% endblock %}
{% block title %}{{ edit ? 'Edit' : 'Add' }} Assignment{% endblock %}
{% block head_title %}{{ edit ? 'Edit' : 'Add' }} Assignment{% endblock %}



{% block other_assets %}
<link rel="stylesheet" type="text/css" href="{{ base_url('assets/select2/select2.min.css') }}">
<style type="text/css">
form {
	width: 100%;
	margin-bottom: 1em;
}
form  select{
	width: 180px;
}

input[type='number'].short_text{
	width: 80px!important;
}
.short_text{
	width: 90px!important;
}
.medium_text{
	min-width: 150px!important;
}

</style>
{% endblock %}

{% block body_end %}
<script type="text/javascript" src="{{ base_url('assets/select2/select2.min.js') }}"></script>
<script type="text/javascript" src="{{ base_url('assets/js/add_assignments.js') }}"></script>
<script type='text/javascript' src="{{ base_url('assets/js/taboverride.min.js') }}"></script>
<script>
	$(document).ready(function(){
		tabOverride.set(document.getElementsByTagName('textarea'));
	});
</script>
<script type="text/javascript">shj.num_of_problems={{ problems|length }};</script>
{% endblock %}


{% block title_menu %}
<span class="title_menu_item">
	<a href="https://github.com/truongan/wecode-judge/blob/docs/v1.4/add_assignment.md" target="_blank"><i class="fa fa-question-circle color1"></i> Help</a>
</span>
{% endblock %}



{% block main_content %}
<div class="col">
{% set msgclasses = {'text-success': 'text-success', 'text-info': 'text-warning', 'text-danger': 'text-danger'} %}

{% for message in messages %}
	<p class="{{ msgclasses[message.type] }}">{{ message.text }}</p>
{% endfor %}

{% if edit %}
<p>
	<i class="fa fa-info-circle fa-lg color8"></i> If you don't want to change tests or pdf file, just do not upload its file.
</p>
{% endif %}

{{ form_open_multipart(edit ? 'assignments/edit/'~edit_problem.id : 'assignments/add') }}

	<div class="row">
		<div class="col-sm-6">
			<fieldset class="form-group">
				<div class="form-row">
					<div class="col-sm-4">
						<label for="form_a_name">Problem Name</label>
					</div>
					<div class="col-sm-8">
						<input id="problem_name" type="text" name="problem_name" class="form-control col-xs-7" value="{{ edit ? edit_problem.name : set_value('problem_name') }}"/>
						{{ form_error('problem_name', '<div class="alert alert-danger">', '</div>') }}
					</div>
				</div>
			</fieldset>
			<fieldset class="form-group">
				<div class="form-row">
					<div class="col-sm-4">
						<label for="form_a_name">Diff command</label>
					</div>
					<div class="col-sm-8">
						<input id="form_a_name" type="text" name="diff_cmd" class="form-control col-xs-7" value="{{ edit ? edit_problem.diff_cmd : set_value('diff_cmd') }}"/>
					</div>
				</div>
			</fieldset>
			<fieldset class="form-group">
				<div class="form-row">
					<div class="col-sm-4">
						<label for="diff_arg">Diff arguments</label>
					</div>
					<div class="col-sm-8">
						<input id="form_a_name" type="text" name="diff_arg" class="form-control col-xs-7" value="{{ edit ? edit_problem.diff_arg : set_value('diff_arg') }}"/>
					</div>
				</div>
			</fieldset>
		
			<fieldset class="form-group">
				<div class="form-row">
					<div class="col-sm-4">
						<label for="form_tests_desc">Tests and Descriptions (zip file)<br>
							<small class="form-text text-muted">
								<a href="https://github.com/truongan/wecode-judge/blob/docs/v1.4/tests_structure.md" target="_blank"><i class="fa fa-question-circle" aria-hidden="true"></i> Use this structure</a>
							</small>
						</label>
					</div>
					<div class="col-sm-8">
						<div class="custom-file">
							<input id="form_tests_desc" type="file" name="tests_desc" class="custom-file-input" />
							<label class="custom-file-label text-muted"><small>Test and description zip file</small></label>
						</div>
					</div>
				</div>
			</fieldset>

		</div>

		<div class="col-sm-6">
			<fieldset class="form-group">
				<div class="form-row">
						<label for="form_late_rule">Coefficient rule (<a target="_blank" href="https://github.com/truongan/wecode-judge/blob/docs/v1.4/add_assignment.md#coefficient-rule">?</a>)
						<small class="form-text text-muted medium clear" style="display: block;">PHP script without &lt;?php ?&gt; tags</small>
						</label>
				<textarea id="form_late_rule" name="late_rule" rows="15" class="form-control add_text">{{ edit ? edit_problem.late_rule : set_value('late_rule', default_late_rule, false) }}</textarea>
				{{ form_error('late_rule', '<div class="alert alert-danger">', '</div>') }}
			</fieldset>
		</div>
	</div>

<span class="btn btn-success pointer mb-2 " id="add">Add Problems <i class="fa fa-plus-circle fa-lg fa-fw pointer" ></i></span>

<table id="problems_table">
	<thead>
	<tr>
		<th >ID</th>
		<th >Name</th>
		<th >Time Limit (ms)</th>
		<th >Memory<br>Limit (kB)</th>
		<th >Allowed</th>
	</tr>
	</thead class="form-inline">
	<tbody>
		{% for lang in languages %}
		<tr>
			<td>{{ lang.id }}</td>
			<td>{{ lang.name }}</td>
			<td><input type="number" name="c_time_limit[]" class="form-control" value="{{ lang.default_time_limit }}"/></td>
			<td><input type="number" name="memory_limit[]" class="form-control" value="{{ lang.default_memory_limit }}"/></td>

			<td><label class="custom-control custom-checkbox custom-control-inline"><input type="checkbox" class="custom-control-input" name="is_upload_only[]" class="check" value="{{ problem.id }}" {{ problem.is_upload_only ? 'checked' }}/><span class="custom-control-label"></span></label></td>

		</tr>
		{% endfor %}
	</tbody>
</table>
{{ form_error('name[]', '<div class="alert alert-danger">', '</div>') }}
{{ form_error('score[]', '<div class="alert alert-danger">', '</div>') }}

<fieldset class="form-group mt-2">
	<input type="submit" value="{{ edit ? 'Edit' : 'Add' }} Assignment" class="sharif_input btn btn-primary"/>
</p>
</form>
</div>
{% endblock %}  {# main_content #}
